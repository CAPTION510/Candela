
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Welcome to Candela’s documentation! &#8212; Candela 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="welcome-to-candela-s-documentation">
<h1>Welcome to Candela’s documentation!<a class="headerlink" href="#welcome-to-candela-s-documentation" title="Permalink to this heading">¶</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h2>
<p>Candela is short for Collection of ANalysis DEsigned for Large-scale Atomic simulations.
It is developed by <a class="reference external" href="https://github.com/MCresearch">MCresearch</a> to conduct analyses on MD trajectory in different formats.
Right now the program only supports analysis of pair distribution function (PDF), static structure factor (SSF) and mean square displacement (MSD).</p>
<p>Section <span class="xref std std-ref">Basic-usage-and-vars</span> introduces the usage of Candela;</p>
<p>Section <span class="xref std std-ref">List-of-supported-analyses</span> introduces the implemented analyses in Candela for now;</p>
<p>Section <span class="xref std std-ref">Develop-guide</span> introduces the structure of a typical analysis subprogram,
in case you may need to add new analysis program to Candela.
The test method is also introduced.</p>
<section id="basic-usage-and-variables">
<h3>Basic usage and variables<a class="headerlink" href="#basic-usage-and-variables" title="Permalink to this heading">¶</a></h3>
</section>
</section>
<section id="compilation">
<h2>Compilation<a class="headerlink" href="#compilation" title="Permalink to this heading">¶</a></h2>
<p>Type <cite>make</cite> in the <cite>Candela</cite> directory to compile the executable <cite>Candela.exe</cite> in <cite>bin</cite> directory.
The default compiler is g++, which could be switched to other compiliers by changing <cite>CC</cite> in <cite>Makefile</cite>.</p>
</section>
<section id="using-candela">
<h2>Using Candela<a class="headerlink" href="#using-candela" title="Permalink to this heading">¶</a></h2>
<p>First, you have to prepare an <cite>INPUT</cite> file containing the input parameters of Candela.
The following shows an example of the <cite>INPUT</cite> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">calculation</span>  <span class="n">pdf</span>       <span class="c1"># pair Distribution Function (radial distribution function).</span>
<span class="n">system</span> <span class="n">hydronium</span>
<span class="n">geo_in_type</span>  <span class="n">QE</span>   <span class="c1"># input type of geometry file: PROFESS/VASP/QE/ABINIT/MESIA</span>
<span class="n">geo_directory</span> <span class="o">../</span><span class="n">H_PBE</span><span class="o">.</span><span class="n">pos</span>
<span class="n">geo_1</span>        <span class="mi">1</span>
<span class="n">geo_2</span>        <span class="mi">10</span>
<span class="n">geo_interval</span> <span class="mi">1</span>

<span class="n">geo_out</span>      <span class="n">pdf</span><span class="o">.</span><span class="n">dat</span> <span class="c1"># output pdf name.</span>

<span class="n">ntype</span>        <span class="mi">2</span>         <span class="c1"># number of different types of atoms.</span>
<span class="n">natom</span>        <span class="mi">190</span>       <span class="c1"># total number of atoms.</span>
<span class="n">natom1</span>       <span class="mi">63</span>
<span class="n">natom2</span>       <span class="mi">127</span>
<span class="n">dr</span>           <span class="mf">0.01</span>      <span class="c1"># delta r in real space</span>
<span class="n">rcut</span>         <span class="mf">6.22</span>     <span class="c1"># real space distance to evaluate the structure factor</span>

<span class="n">id1</span> <span class="n">O</span>
<span class="n">id2</span> <span class="n">H</span>
<span class="n">ele1</span> <span class="n">O</span>
<span class="n">ele2</span> <span class="n">O</span>

<span class="n">celldm1</span> <span class="mf">12.444655509</span>
<span class="n">celldm2</span> <span class="mf">12.444655509</span>
<span class="n">celldm3</span> <span class="mf">12.444655509</span>
</pre></div>
</div>
<p>In each line the first item specifies the name of the parameter,
and you may fill in the value of the parameter after it.
The following chart displays the general parameters and their purposes.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Name</p></td>
<td><p>Type</p></td>
<td><p>Example</p></td>
<td><p>Discription</p></td>
</tr>
<tr class="row-even"><td><p><em>calculation</em></p></td>
<td><p>String</p></td>
<td><p>pdf</p></td>
<td><p>Name of analysis</p></td>
</tr>
<tr class="row-odd"><td><p><em>system</em></p></td>
<td><p>String</p></td>
<td><p>water</p></td>
<td><p>Name of the system</p></td>
</tr>
<tr class="row-even"><td><p><em>geo_in_type</em></p></td>
<td><p>String</p></td>
<td><p>QE</p></td>
<td><p>directory of the
MD trajectory file</p></td>
</tr>
<tr class="row-odd"><td><p><em>geo_1</em></p></td>
<td><p>Int</p></td>
<td><p>1</p></td>
<td><p>Starting index of snapshot
in the MD trajectory file.
In most cases it has to be 1.</p></td>
</tr>
<tr class="row-even"><td><p><em>geo_2</em></p></td>
<td><p>Int</p></td>
<td><p>10</p></td>
<td><p>End index of snapshot
in the MD trajectory file.</p></td>
</tr>
<tr class="row-odd"><td><p><em>geo_interval</em></p></td>
<td><p>Int</p></td>
<td><p>1</p></td>
<td><p>The program analyse 1 snapshot
for every <cite>geo_interval</cite>
snapshots</p></td>
</tr>
<tr class="row-even"><td><p><em>ntype</em></p></td>
<td><p>Int</p></td>
<td><p>2</p></td>
<td><p>Number of atom species.</p></td>
</tr>
<tr class="row-odd"><td><p><em>natom</em></p></td>
<td><p>Int</p></td>
<td><p>192</p></td>
<td><p>Number of atoms.</p></td>
</tr>
<tr class="row-even"><td><p><em>natom1</em></p></td>
<td><p>Int</p></td>
<td><p>64</p></td>
<td><p>Number of atoms of type 1.</p></td>
</tr>
<tr class="row-odd"><td><p><em>natom2</em></p></td>
<td><p>Int</p></td>
<td><p>128</p></td>
<td><p>Number of atoms of type 2.</p></td>
</tr>
<tr class="row-even"><td><p><em>id1</em></p></td>
<td><p>String</p></td>
<td><p>O</p></td>
<td><p>Element name of the
1st species of atoms.</p></td>
</tr>
<tr class="row-odd"><td><p><em>id2</em></p></td>
<td><p>String</p></td>
<td><p>H</p></td>
<td><p>Element name of the
2nd species of atoms.</p></td>
</tr>
<tr class="row-even"><td><p><em>celldm1</em></p></td>
<td><p>Float</p></td>
<td><p>12.444655509</p></td>
<td><p>Length of the cell
in the 1st dimension.</p></td>
</tr>
<tr class="row-odd"><td><p><em>celldm2</em></p></td>
<td><p>Float</p></td>
<td><p>12.444655509</p></td>
<td><p>Length of the cell
in the 2nd dimension.</p></td>
</tr>
<tr class="row-even"><td><p><em>celldm3</em></p></td>
<td><p>Float</p></td>
<td><p>12.444655509</p></td>
<td><p>Length of the cell
in the 3rd dimension.</p></td>
</tr>
<tr class="row-odd"><td><p><em>dt_snapshots</em></p></td>
<td><p>Float</p></td>
<td><p>4.83776865e-5</p></td>
<td><p>A single MD timestep of <cite>cp.x</cite>
in ps. The value is needed
for trajectory over 100 ps.</p></td>
</tr>
</tbody>
</table>
<p>For <cite>geo_in_type</cite>, currently supported formats include pw.x (<cite>QE2</cite>),
cp.x (<cite>QE</cite>), VASP (<cite>VASP</cite>), ABACUS (<cite>ABACUS</cite>), PWmat (<cite>PWMAT</cite>) and so on.</p>
<p>The physical quantities used in the program are all in Angstrom/ps/eV unit.</p>
<p>Other parameters are needed for specific <cite>calculation</cite>,
which you may refer to <span class="xref std std-ref">List-of-supported-analyses</span> where a detailed summary of supported <cite>calculation</cite> of analyses is given.
You may refer to the example <cite>INPUT</cite> files in <cite>/examples</cite> as well for different kinds of analyses.</p>
<section id="list-of-supported-analyses">
<h3>List of supported analyses<a class="headerlink" href="#list-of-supported-analyses" title="Permalink to this heading">¶</a></h3>
</section>
</section>
<section id="pdf-pair-distribution-function">
<h2>PDF (Pair distribution function)<a class="headerlink" href="#pdf-pair-distribution-function" title="Permalink to this heading">¶</a></h2>
<p>Pair distribution function, also radial distribution function.
The following parameters are needed for <cite>pdf</cite> calculation:</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>rcut</cite> Radius cutoff of pair distribution function calculation.</p></li>
<li><p><cite>dr</cite> Grid length of radius.</p></li>
<li><p><cite>id1</cite> Name of the first type of atom of the pdf. For example, for <span class="math notranslate nohighlight">\(g_{OH}(r)\)</span>, <cite>id1</cite> is O.</p></li>
<li><p><cite>id2</cite> Name of the second type of atom of the pdf. For example, for <span class="math notranslate nohighlight">\(g_{OH}(r)\)</span>, <cite>id2</cite> is H.</p></li>
</ul>
</div></blockquote>
</section>
<section id="ssf-static-structure-factor">
<h2>SSF (Static structure factor)<a class="headerlink" href="#ssf-static-structure-factor" title="Permalink to this heading">¶</a></h2>
<p>The analysis calculates static structure factor (SSF) of single element. For water it only calculates SSF between oxygen atoms <span class="math notranslate nohighlight">\(S_{OO}(k)\)</span>.
The following parameters are also needed for the calculation:</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>struf_dgx/struf_dgy/struf_dgz</cite> The parameters specify <span class="math notranslate nohighlight">\(\Delta k\)</span> on three directions. Typically it has to be an integer multiple of <span class="math notranslate nohighlight">\(2\pi/\mathrm{celldm}\)</span>, where <span class="math notranslate nohighlight">\(\mathrm{celldm}\)</span> is the cell length on corresponding direction.</p></li>
<li><p><cite>struf_ng</cite> Number of <cite>dg</cite> on each direction.</p></li>
<li><p><cite>ssf_out</cite> SSF output file name.</p></li>
</ul>
</div></blockquote>
</section>
<section id="msd-mean-square-displacement">
<h2>MSD (Mean square displacement)<a class="headerlink" href="#msd-mean-square-displacement" title="Permalink to this heading">¶</a></h2>
<p>The analysis calculates the mean square displacement (MSD) by averaging square displacement over all atoms.
By Einstein’s relation, MSD of molecule in liquid is linearly dependent on time by which we could deduce the diffusivity.
For system with more than one type of element, the program will treat every type of element as one element.
See <cite>003_MSD</cite> for example of <cite>msd</cite> calculation.
The following parameters are needed for calculation of MSD:</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>msd_dt</cite> Time step between two printed snapshots.</p></li>
</ul>
</div></blockquote>
<section id="developing-guide">
<h3>Developing guide<a class="headerlink" href="#developing-guide" title="Permalink to this heading">¶</a></h3>
<p>Before adding new analysis subprogram to Candela,
we recommand you to go through the existing analysis subprogram list in case the needed analysis is already fulfilled.
This part introduces the basic structure of an analysis subroutine,
by learning which you could write new analysis subroutines on your own.</p>
</section>
</section>
<section id="analysis-program-template">
<h2>Analysis program template<a class="headerlink" href="#analysis-program-template" title="Permalink to this heading">¶</a></h2>
<p>To write new subprograms in Candela, it is necessary to understand and take use of the basic classes implemented.
They will greatly help you in developing your own codes.
The following table summarizes the basic classes and their properties and methods that are most used in Candela.
There are mainly four kinds of classes: <code class="code docutils literal notranslate"><span class="pre">Vector3&lt;T&gt;</span></code>, <code class="code docutils literal notranslate"><span class="pre">Cell</span></code>, <code class="code docutils literal notranslate"><span class="pre">Atom</span></code> and <code class="code docutils literal notranslate"><span class="pre">Water</span></code>.
<cite>Cellfile</cite> is a class inherited from <code class="code docutils literal notranslate"><span class="pre">Cell</span></code> and mainly contains methods reading data from MD trajectory in different formats.
All of the classes are straightforwardly defined and directly correspond to physical entities.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Class Name (source file)</p></td>
<td><p>Properties</p></td>
<td><p>Property description</p></td>
<td><p>Methods</p></td>
<td><p>Method description</p></td>
</tr>
<tr class="row-even"><td rowspan="6"><dl class="simple">
<dt><code class="code docutils literal notranslate"><span class="pre">Vector3&lt;T&gt;</span></code></dt><dd><p>(<cite>vec3.h</cite>)</p>
</dd>
</dl>
</td>
<td rowspan="6"><p><cite>T x, y, z</cite></p></td>
<td rowspan="6"><p>component of the vector
on three directions</p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">Vector&lt;T&gt;</span> <span class="pre">+-*/</span> <span class="pre">T</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(+-\times \div\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">Vector</span> <span class="pre">cos/sin</span> <span class="pre">(Vector)</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\sin/ \cos\)</span></p></td>
</tr>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">T</span> <span class="pre">norm</span> <span class="pre">(Vector)</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(x^2+y^2+z^2\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">Vector</span> <span class="pre">+-*^/</span> <span class="pre">Vector</span></code></p></td>
<td><p>^ for outer product</p></td>
</tr>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">T</span> <span class="pre">dot(Vector,</span> <span class="pre">Vector)</span></code></p></td>
<td><p>inner product</p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">T</span> <span class="pre">cross(Vector,</span> <span class="pre">Vector)</span></code></p></td>
<td><p>outer product</p></td>
</tr>
<tr class="row-even"><td rowspan="6"><p><code class="code docutils literal notranslate"><span class="pre">Atom</span></code>
(<cite>atoms.h/atoms.cpp</cite>)</p></td>
<td><p><cite>string id</cite></p></td>
<td><p>name of the element</p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">void</span> <span class="pre">read_pos/read_pos2</span></code>
<code class="code docutils literal notranslate"><span class="pre">/read_pos3/read_pos4</span></code></p></td>
<td><p>read in positions of atom.
Input arguements are not listed here.</p></td>
</tr>
<tr class="row-odd"><td><p><cite>int na</cite></p></td>
<td><p>number of atoms of the element</p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">void</span> <span class="pre">read_vel</span></code></p></td>
<td><p>read in velocities of atom. Currently only
available in <cite>QE</cite>.</p></td>
</tr>
<tr class="row-even"><td><p><cite>Vector3&lt;dou</cite>
<cite>ble&gt;*pos</cite></p></td>
<td><p>positions of atoms</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><cite>Vector3&lt;dou</cite>
<cite>ble&gt;*posd</cite></p></td>
<td><p>direct positions of atoms</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p><cite>Vector3&lt;dou</cite>
<cite>ble&gt;*vel</cite></p></td>
<td><p>velocities of atoms</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><cite>double mass</cite></p></td>
<td><p>mass of atom</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td rowspan="7"><p><cite>Cell</cite> (cell.h/cell.cpp)</p></td>
<td><p><cite>int na</cite></p></td>
<td><p>number of atoms of the element</p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">void</span> <span class="pre">direct2cartesian</span></code></p></td>
<td><p>convert positions in direct coordination into
Cartesian coordination</p></td>
</tr>
<tr class="row-odd"><td><p><cite>int ntypes</cite></p></td>
<td><p>number of elements</p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">void</span> <span class="pre">cartesian2direct</span></code></p></td>
<td><p>convert positions in Cartesian coordination into
direct coordination</p></td>
</tr>
<tr class="row-even"><td><p><cite>Atom* atom</cite></p></td>
<td><p>atoms in the cell</p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">void</span> <span class="pre">read_wannier</span></code>
<code class="code docutils literal notranslate"><span class="pre">_centers</span></code></p></td>
<td><p>read in Wannier center positions.
Now only cp.x (<cite>QE</cite>) format is supported.</p></td>
</tr>
<tr class="row-odd"><td><p><cite>Vector3</cite>
<cite>&lt;double&gt;*wa</cite>
<cite>n_centers</cite></p></td>
<td><p>Wannier centers in the cell</p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">void</span> <span class="pre">read_eig</span> <span class="pre">()</span></code></p></td>
<td><p>read in eigen value of the solved KS equation.
Now only pw.x (<cite>QE2</cite>) format is supported.</p></td>
</tr>
<tr class="row-even"><td><p><cite>double `
`snapshot</cite>
<cite>_time</cite></p></td>
<td><p>simulation time of the
current snapshot</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><cite>double `
`snapshot</cite>
<cite>_index</cite></p></td>
<td><p>simulation snapshot index of the
current snapshot</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p><cite>double* eig</cite></p></td>
<td><p>eigen value of the solved
KS equation</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td rowspan="5"><p><cite>Cell CellFile`(`cellFile</cite>
<cite>.h/cpp, cellFilePROFESS</cite>
<cite>/VASP/QE/QE2.cpp, etc.</cite>)</p></td>
<td><p><cite>static ifst</cite>
<cite>ream ifs_</cite>
<cite>pos_kept</cite></p></td>
<td><p>ifstream opening the file
containing atomic positions</p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">static</span></code>
<code class="code docutils literal notranslate"><span class="pre">bool</span> <span class="pre">ReadGeometry()</span></code></p></td>
<td><p>read in atomic positions</p></td>
</tr>
<tr class="row-even"><td><p><cite>static ifst</cite>
<cite>ream ifs_</cite>
<cite>wan_kept</cite></p></td>
<td><p>ifstream opening the file
containing Wannier centers</p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">static</span> <span class="pre">bool</span></code>
<code class="code docutils literal notranslate"><span class="pre">ReadGeometry_PROFESS</span></code>
<code class="code docutils literal notranslate"><span class="pre">/VASP/QE/QE2</span> <span class="pre">...</span></code></p></td>
<td><p>read in atomic positions of different type</p></td>
</tr>
<tr class="row-odd"><td><p><cite>static ifst</cite>
<cite>ream ifs_</cite>
<cite>cel_kept</cite></p></td>
<td><p>ifstream opening the file
containing lattice vectors</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p><cite>static ifst</cite>
<cite>ream ifs_</cite>
<cite>eig_kept</cite></p></td>
<td><p>ifstream opening the file
containing eigenvalues</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><cite>static ifst</cite>
<cite>ream ifs_</cite>
<cite>vel_kept</cite></p></td>
<td><p>ifstream opening the file
containing velocities of atom</p></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="the-structure-of-a-typical-analysis-c-file">
<h2>The structure of a typical analysis C++ file<a class="headerlink" href="#the-structure-of-a-typical-analysis-c-file" title="Permalink to this heading">¶</a></h2>
<p>Here we give a brief description of <cite>example.cpp</cite> contained in <cite>/examples/example</cite> to show how a typical analysis of water system could be done under the frame of Candela.</p>
<p>First, the class <cite>Example</cite> and its properties and methods are defined in <cite>example.h</cite> as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifndef EXAMPLE_H</span>
<span class="cp">#define EXAMPLE_H</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Cellfile.h&quot;</span><span class="cp"></span>
<span class="k">class</span><span class="w"> </span><span class="nc">Example</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="w">   </span><span class="n">Example</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="o">~</span><span class="n">Example</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="kt">void</span><span class="w"> </span><span class="nf">Routine</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="kt">void</span><span class="w"> </span><span class="nf">calc</span><span class="p">(</span><span class="n">CellFile</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cel</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="kt">void</span><span class="w"> </span><span class="nf">output</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="kt">double</span><span class="o">*</span><span class="w"> </span><span class="n">example_arr</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">example_len</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>The function <cite>Routine()</cite> is to be called in the <cite>main.cpp</cite> to implement the analysis. Function <cite>calc()</cite> takes in all information of a cell of a single snapshot and do the calculations. Function <cite>output()</cite> writes out the results in files.</p>
<p>In <cite>example.cpp</cite>, function <cite>Routine()</cite> is realized as the follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">Example::Routine</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="c1">// Initialize necessary arrays.</span>
<span class="w">   </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">example_arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">double</span><span class="p">[</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">example_len</span><span class="p">];</span><span class="w"></span>

<span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">count_geometry_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">igeo</span><span class="o">=</span><span class="n">INPUT</span><span class="p">.</span><span class="n">geo_1</span><span class="p">;</span><span class="w"> </span><span class="n">igeo</span><span class="o">&lt;=</span><span class="n">INPUT</span><span class="p">.</span><span class="n">geo_2</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">igeo</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="c1">// cel : input geometry file</span>
<span class="w">      </span><span class="n">CellFile</span><span class="w"> </span><span class="n">cel</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">igeo</span><span class="o">&lt;</span><span class="n">INPUT</span><span class="p">.</span><span class="n">geo_ignore</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">igeo</span><span class="o">%</span><span class="n">INPUT</span><span class="p">.</span><span class="n">geo_interval</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">         </span><span class="n">cel</span><span class="p">.</span><span class="n">read_and_used</span><span class="o">=</span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="n">cel</span><span class="p">.</span><span class="n">read_and_used</span><span class="o">=</span><span class="nb">true</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="n">stringstream</span><span class="w"> </span><span class="n">ss</span><span class="p">;</span><span class="w"> </span><span class="n">ss</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">igeo</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">cel</span><span class="p">.</span><span class="n">file_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ss</span><span class="p">.</span><span class="n">str</span><span class="p">();</span><span class="w"></span>

<span class="w">      </span><span class="c1">// cel : input geometry file</span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">CellFile</span><span class="o">::</span><span class="n">ReadGeometry</span><span class="p">(</span><span class="w"> </span><span class="n">cel</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">cel</span><span class="p">.</span><span class="n">read_and_used</span><span class="o">==</span><span class="nb">false</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">         </span><span class="n">cel</span><span class="p">.</span><span class="n">clean</span><span class="p">();</span><span class="w"> </span><span class="c1">// renxi added 20200614</span>
<span class="w">         </span><span class="k">continue</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="o">++</span><span class="n">count_geometry_number</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;snapshot &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">igeo</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">calc</span><span class="p">(</span><span class="n">cel</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">cel</span><span class="p">.</span><span class="n">clean</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="c1">//igeo</span>

<span class="w">   </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">output</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">example_arr</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<dl class="simple">
<dt>The function first initialize the memory of array used in this analysis. Then, it iteratively do the following things to each snapshots in the MD trajectory:</dt><dd><ul class="simple">
<li><p>judge whether the snapshot has to be analyzed (<cite>if(igeo&lt;INPUT.geo_ignore || igeo%INPUT.geo_interval!=0) `). If so, label the snapshot as non-ignorable (`cel.read_and_used=true;</cite>);</p></li>
<li><p>read in the atomic positions and velocities, Wannier centers etc. if necessary (<cite>if( !CellFile::ReadGeometry( cel ) ) continue;</cite>);</p></li>
<li><p>judge whether the snapshot is ignorable, if so, clean the cell and move on to the next iteration (<cite>cel.clean(); continue;</cite>); else, go to step 4;</p></li>
<li><p>do some calculations to the cell of the snapshot (<cite>this-&gt;calc(cel);</cite>) and clean the cell.</p></li>
</ul>
</dd>
</dl>
<p>And of course, you have to add your analysis to <cite>main.cpp</cite> as well to let it run.</p>
</section>
<section id="adding-test-for-the-subprogram">
<h2>Adding test for the subprogram<a class="headerlink" href="#adding-test-for-the-subprogram" title="Permalink to this heading">¶</a></h2>
<p>After adding new functions into CANDELA, we must add corresponding tests.
Directory <strong>test</strong> contains:</p>
<p><strong>001_PDF</strong>,…: test cases</p>
<p><strong>Autotest.sh</strong>: shell script to run auto tests.</p>
<p><strong>tool</strong>: some tool functions</p>
<p><strong>geo</strong>: contains geometry files</p>
</section>
<section id="preparation-for-one-case">
<h2>Preparation for one case<a class="headerlink" href="#preparation-for-one-case" title="Permalink to this heading">¶</a></h2>
<p><strong>compare</strong>:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>threshold 1e-4

enable_mpi ON

pdf.ref  pdf.txt

other.ref other.result

...
</pre></div>
</div>
<p>threshold: When the relative errors between reference results and calculating results are larger than threshold, the tests will fail.</p>
<p>enable_mpi: Whether this case supports MPI or not.</p>
<p>The remaining lines are reference files and result files. Each pair is in one line.</p>
<p><strong>INPUT</strong>:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>calculation  pdf <span class="c1"># Pair Distribution Function.</span>
system Al
geo_in_type  LAMMPS
geo_directory ../geo/Al64.dump
geo_1        <span class="m">0</span>
geo_2        <span class="m">20</span>
geo_interval <span class="m">1</span>
geo_ignore   <span class="m">4</span>

geo_out      pdf.txt <span class="c1"># output pdf name.</span>

ntype        <span class="m">1</span>        <span class="c1"># number of different types of atoms.</span>
natom        <span class="m">64</span>   <span class="c1"># total number of atoms.</span>
natom1       <span class="m">64</span>
rcut         <span class="m">6</span>
dr           <span class="m">0</span>.01     <span class="c1"># delta r in real space</span>
</pre></div>
</div>
<p><strong>pdf.ref / other.ref / …</strong>:
The reference results are in them.</p>
</section>
<section id="run-auto-test">
<h2>Run auto test<a class="headerlink" href="#run-auto-test" title="Permalink to this heading">¶</a></h2>
<p><strong>method 1</strong>:</p>
<p>or</p>
<p>Autotest.sh will be executed after serial-version <strong>candela</strong> is compiled.</p>
<p><cite>make CC=mpicxx TEST=ON</cite></p>
<p>Autotest.sh will be executed after parallel-version <strong>candela</strong> is compiled. Multi-processor cases will be tested at the same time.</p>
<p><a href="#id1"><span class="problematic" id="id2">**</span></a>All developers should run</p>
<p><cite>make CC=g++ TEST=ON</cite>
and <cite>make CC=mpicxx TEST=ON</cite></p>
<p>to make sure some functions are not be destroyed.**</p>
<p><strong>method 2</strong>:</p>
<p>After <strong>candela</strong> is compiled.</p>
<p><cite>make test</cite> or <cite>cd test;sh Autotest.sh</cite></p>
<p>It will run one-processor tests.</p>
<p><cite>make test CC=mpicxx</cite> or <cite>cd test;sh Autotest.sh ON</cite></p>
<p>It will run one-processor and multi-processor tests.</p>
<p>That’s all we would like to say in this documentation. Please feel free to contact us for any help.</p>
<p>Happy using Candela and coding!</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="#">Candela</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="#">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, 510Group.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 6.1.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="_sources/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>